<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"></meta>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Red Pitaya</title>
    <link rel="stylesheet" href="../assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../assets/popupstack.css" type="text/css" />
    <link rel="stylesheet" href="../assets/help-system/help-system.css" type="text/css" />
    <link href="../assets/loader.css?1" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="css/style.css?2">
    <script src="../assets/jquery/jquery-2.1.3.min.js"></script>
    <script src="../assets/jquery/jquery-ui.min.js"></script>
    <script src="../assets/jquery/jquery.ui.touch-punch.min.js"></script>
    <script src="../assets/jquery/jquery.cookie.js?3"></script>
    <script src="../assets/jquery/jquery.browser.js"></script>
    <script src="../assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="../assets/browsercheck.js?1"></script>
    <script src="../assets/analytics-core.js"></script>
    <script src="../assets/popupstack.js?1"></script>
    <script src="../assets/help-system/help-system.js"></script>
    <script src="../assets/pako.js"></script>
    <script src="js/analytics-main.js"></script>
    <script src="js/help-sm.js"></script>
    <script src="js/guiHandler.js"></script>
    <script src="js/sm.js"></script>

    <!-- CHARTS -->
    <script src="apexcharts.js"></script>
</head>

<body>
   <!--  <div id="header">
        <div id="description">&nbsp;</div>
    </div>
    <div class="full-content">
            <div id="">
                <div id="main">
                    <div>
                        <div>
                            <div align="center" style="font-size: 18pt; color: lightgray;">
                                <p>Example</p>
                            </div>
                        </div>
                        <div>
                            <div align="center">
                                <div class="container_inline">
                                    <div style="width: 80px;text-align: right;">TEXT:</div>
                                    <div style="width: 250px;">
                                        <input id="SS_STRING_P" type="text">
                                    </div>
                                </div>
                                <div class="container_inline">
                                    <div style="width: 80px;text-align: right;">NUMBER:</div>
                                    <div style="width: 250px;">
                                        <input id="SS_INT_P" type="text">
                                    </div>
                                </div>
                                <div class="container_inline">
                                    <div style="width: 80px;text-align: right;">BOOL:</div>
                                    <div style="width: 250px;">
                                        <select id="SS_BOOL_P" class="protocol" name="channels">
                                            <option value="0">False</option>
                                            <option value="1">True</option>                                                            
                                        </select>
                                    </div>
                                </div>

                                <div class="container_inline">
                                    <div style="width: 330px;height: 30px;">
                                        <li class="buttons" id="PRESS_BUT" style="width: 120px;height: 30px">
                                            <a href="#" id="a_run" style="">PRESS</a>
                                        </li>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> -->

    <div class="topnav">
        <h1>Strele detector by Moƒçeradi</h1>
        </div>
        <div class="content">
        <div class="card" >
            <h2 class="collapseBtn">Values</h2>
            <div class="collapsible">
            <p class="text">Distance = <span id="distance_text"></span></p>
            <p class="text">Light = <span id="light_text"></span></p>
            </div>
        </div>
        
        <div id="wrapper">
            <div class="content-area">
            <div class="container-fluid">
                <div class="main">
                <div class="card">
                    <div id="linechart"> </div>
                </div>     
                </div>
            </div>
            </div>
        </div>
        </div> 
</body>

<script>

//Iteration of graph data
var i = 0;

//Current parameter value to be displayed on the chart
var chartVal = 0;

//Data variables
var distance = 0;
var light = 0;

//New data
function getNewData()
{
  //Random values for testing
  distance = Math.floor(Math.random() * 100);
  light = Math.floor(Math.random() * 100);

  chartVal = distance;

  //Change view values according to received data
  document.getElementById("distance_text").innerHTML = distance;
  document.getElementById("light_text").innerHTML = light;
}

//For testing run getNewData() periodically every 1s
window.setInterval(function () {
  getNewData();
}, 1000);



//PLOT
var updateInterval = 1000; //ms
var updateXAxis = updateInterval;
var xAxisRange = 60*1000; //ms => 60s

var d = new Date();
var startTime = 0;

window.Apex = {
  chart: {
    foreColor: "#fff",
    toolbar: {
      show: false
    }
  },
  colors: ["#FCCF31", "#17ead9", "#f02fc2"],
  stroke: {
    width: 2
  },
  dataLabels: {
    enabled: false
  },
  grid: {
    borderColor: "#40475D"
  },
  xaxis: {
    axisTicks: {
      color: "#333"
    },
    axisBorder: {
      color: "#333"
    }
  },
  fill: {
    type: "gradient",
    gradient: {
      gradientToColors: ["#F55555", "#6078ea", "#6094ea"]
    }
  },
  tooltip: {
    theme: "dark",
    x: {
      /* formatter: function (val) {
        return moment(new Date(val)).format("HH:mm:ss");
      } */
    }
  },
  yaxis: {
    decimalsInFloat: 2,
    opposite: true,
    labels: {
      offsetX: -10
    }
  }
};

function getNewChartData() {
  return chartVal;
}

function generateMinuteWiseTimeSeries(baseval, count) {
  var i = 0;
  var series = [];
  while (i < count) {
    var x = baseval;
    var y = i;
    series.push([x, y]);
    baseval += updateXAxis; //300000;
    i++;
  }
  return series;
}

var optionsLine = {
  chart: {
    height: 350,
    type: "line",
    stacked: true,
    animations: {
      enabled: false,
      easing: "linear",
    },
    toolbar: {
      show: false
    },
    zoom: {
      enabled: false
    }
  },
  dataLabels: {
    enabled: false
  },
  stroke: {
    curve: "straight",
    width: 3
  },
  grid: {
    padding: {
      left: 0,
      right: 0
    }
  },
  markers: {
    size: 0,
    hover: {
      size: 0
    }
  },
  series: [
    {
      name: "Distance",
      data: generateMinuteWiseTimeSeries(
        new Date().getTime(),
        //startTime,
        6
      )    
    }
  ],
  xaxis: {
    type: "datetime",
    range: xAxisRange 
  },
  title: {
    text: "Position",
    align: "left",
    style: {
        fontSize: "15px"
    }
  },
  legend: {
    show: true,
    floating: true,
    horizontalAlign: "left",
    onItemClick: {
      toggleDataSeries: false
    },
    position: "top",
    offsetY: -33,
    offsetX: 60
  }
};

var chartLine = new ApexCharts(
  document.querySelector("#linechart"),
  optionsLine
);
chartLine.render();

//Update chart data periodically
window.setInterval(function () {
  //Set all data previous data that apex chart creates to 0
  if(i == 0)
  {
    for(k = 0; k < 6; k++)
    {
      chartLine.w.config.series[0].data[k][1] = 0;
    }
  }

  //Slice out old data 
  if(i < xAxisRange/updateInterval) t = 0;
  else t = 1;
  i++;
  //console.log("i: " + i + "   t: " + t);

  chartLine.updateSeries([
  {
    /* data:chartDataArray */
    data: [
      ...chartLine.w.config.series[0].data.slice(t),
      [chartLine.w.globals.maxX + updateXAxis, getNewChartData()]
    ]
  }
  ]);
}, updateInterval);
    
    
</script>
    

</html>